<link href="https://fonts.googleapis.com/css2?family=Tangerine&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=MedievalSharp&family=Eagle+Lake:wght@400&display=swap" rel="stylesheet">
<form class="{{cssClass}} {{actor.type}} flexcol" autocomplete="off">
<script>
	// Enhanced sheen clipping function
	function updateSheenClipping() {
		const hpBar = document.querySelector('.hp-bar');
		if (hpBar) {
			const hpFillPercent = (hpBar.value / hpBar.max) * 100;
			const hpSheenWrapper = document.querySelector('.hp-sheen-wrapper');
			if (hpSheenWrapper) {
				hpSheenWrapper.style.width = `${hpFillPercent}%`;
			}
		}
	}

	function initializeSheenClipping() {
		let attempts = 0;
		const maxAttempts = 10;
		function tryUpdate() {
			attempts++;
			const hpBar = document.querySelector('.hp-bar');
			if (hpBar) {
				updateSheenClipping();
			} else if (attempts < maxAttempts) {
				setTimeout(tryUpdate, 100);
			}
		}
		tryUpdate();
	}

	document.addEventListener('DOMContentLoaded', initializeSheenClipping);
	document.addEventListener('renderActorSheet', function() {
		setTimeout(initializeSheenClipping, 100);
	});
	document.addEventListener('change', function(e) {
		if (e.target.name && e.target.name.includes('health')) {
			setTimeout(updateSheenClipping, 50);
		}
	});
	setInterval(function() {
		const hpBar = document.querySelector('.hp-bar');
		if (hpBar) { updateSheenClipping(); }
	}, 2000);
</script>

<div class="unique-logo-container">
	<img class="logo" src="systems/stryder/assets/stryderfvtt_title_m.png" width="125" height="125">
</div>

{{!-- Sheet Header --}}
<header class="sheet-header">
	<img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
	<div class="header-fields">
		<div class="fantasy-input" style="width: 450px; display: flex; align-items: center; gap: 20px;">
			<input name="name" type="text" value="{{actor.name}}" placeholder="Pet Name" style="flex: 1;"/>
		</div><br />
		<div class="character-details-secondary textalign-center flexrow" style="margin-bottom: 8px;">
			<div class="character-species">
				<label for="{{actor._id}}species" class="resource-label-info">{{localize "Species"}}</label>
				<input id="{{actor._id}}species" type="text" name="system.species" value="{{system.species}}" placeholder="Species Name" data-dtype="String"/>
			</div>
			<div class="character-size">
				<label for="{{actor._id}}creature_size" class="resource-label-info">{{localize "Size"}}</label>
				<div class="dropdown-field">
					<select class="secondary-input" name="system.attributes.creature_size" style="width: 100%; font-size: 16px; font-weight: normal;">
						{{#select system.attributes.creature_size}}
						<option value="0.25">Mini</option>
						<option value="0.5">Small</option>
						<option value="1">Normal</option>
						<option value="2">Huge</option>
						{{/select}}
					</select>
				</div>
			</div>
			<div class="character-rarity">
				<label for="{{actor._id}}rarity" class="resource-label-info">{{localize "Rarity"}}</label>
				<input id="{{actor._id}}rarity" type="text" name="system.attributes.rarity" value="{{system.attributes.rarity}}" placeholder="Common, Rare, etc." data-dtype="String"/>
			</div>
		</div>

		<div class="resources grid grid-2col">
			<div class="resource flex-group-center">
				<label for="system.health.value" class="resource-label"><img style="width: 15px; height: 15px; border: 0px; position: relative; top: 15px; left: -5px; margin-left: 15px;" src="systems/stryder/assets/health-symbol.svg">{{localize "Health"}}</label>
				<div class="hpbar">
					<div class="hp-progress-bar">
						<progress class="hp-bar grid-span-3" value="{{system.health.value}}" max="{{system.health.max}}"></progress>
						<div class="hp-sheen-wrapper">
							<div class="hp-sheen"></div>
						</div>
					</div>
				</div>
				<div class="resource-content flexrow flex-center flex-between">
					<input type="text" name="system.health.value" value="{{system.health.value}}" data-dtype="Number"/>
					<span> / </span>
					<input type="text" name="system.health.max" value="{{system.health.max}}" data-dtype="Number"/>
				</div>
			</div>

			<div class="resource flex-group-center">
				<label for="system.attributes.movement.value" class="resource-label"><img style="width: 20px; height: 20px; border: 0px; position: relative; top: 10px; left: -5px; margin-left: 15px;" src="systems/stryder/assets/movement-speeds.svg">{{localize "Movement"}}</label>
				<div class="resource-content flexrow flex-center flex-between">
					<input type="text" name="system.attributes.movement.value" value="{{system.attributes.movement.value}}" data-dtype="Number"/>
				</div>
			</div>
		</div>
	</div>
</header>

{{!-- Sheet Tab Navigation --}}
<nav class="sheet-tabs tabs" data-group="primary">
	<a class="item" data-tab="details">Details</a>
	<a class="item" data-tab="description">Information</a>
</nav>

{{!-- Sheet Body --}}
<section class="sheet-body">

	{{!-- Details Tab --}}
	<div class="tab details" data-group="primary" data-tab="details">

		{{!-- Top row: Pet Stats | Trust Level --}}
		<div class="grid grid-2col" style="margin-top: 20px;">
			<div class="resource-section">
				<h3 class="fantasy-section-title">
					<span class="title-decoration left"></span>
					<span class="title-text">Pet Stats</span>
					<span class="title-decoration right"></span>
				</h3>
				<ol class="items-list">
					<li class="item flexrow items-header">
						<div class="item-name">{{localize "Pet Gear"}}&nbsp;<i class="toggle-icon fas fa-chevron-down"></i></div>
						<div class="item-controls">
							<a class="item-control item-create" title="Create Gear" data-type="gear">
								<i class="fas fa-plus"></i> {{localize "DOCUMENT.New" type=""}}
							</a>
						</div>
					</li>
					{{#each gear as |item id|}}
					<li class="item flexrow" data-item-id="{{item._id}}">
						<div class="item-name">
							<div class="item-image">
								<a class="rollable" data-roll-type="item">
									<img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
								</a>
							</div>
							<h4>{{item.name}}</h4>
						</div>
						<div class="item-controls">
							<a class="item-control item-duplicate" title='{{localize "STRYDER.DOCUMENT.Duplicate"}}'><i class="fas fa-copy"></i></a>
							<a class="item-control item-edit" title='{{localize "DOCUMENT.Edit" type="gear"}}'><i class="fas fa-edit"></i></a>
							<a class="item-control item-delete" title='{{localize "DOCUMENT.Delete" type="gear"}}'><i class="fas fa-trash"></i></a>
						</div>
					</li>
					{{/each}}
				</ol>
			</div>

			<div class="resource-section">
				<h3 class="fantasy-section-title">
					<span class="title-decoration left"></span>
					<span class="title-text">Trust Level</span>
					<span class="title-decoration right"></span>
				</h3>
				<div class="detail-field">
					<label>{{localize "Trust Points"}}</label>
					<div class="flexrow" style="align-items: center; justify-content: center; gap: 6px; margin-top: 4px;">
						<button type="button" class="resource-button" data-action="trustDecrease" style="width: 28px; height: 28px; font-size: 18px; line-height: 1; cursor: pointer;">âˆ’</button>
						<input type="text" name="system.trust.points" value="{{system.trust.points}}" data-dtype="Number" style="text-align: center; width: 55px;"/>
						<button type="button" class="resource-button" data-action="trustIncrease" style="width: 28px; height: 28px; font-size: 18px; line-height: 1; cursor: pointer;">+</button>
					</div>
					<div style="text-align: center; margin-top: 6px; font-family: 'Eagle Lake', sans-serif; font-size: 15px; font-weight: bold;">
						{{system.trust.level}}
					</div>
				</div>
			</div>
		</div>

		{{!-- Diet section --}}
		<div class="resource-section" style="margin-top: 20px;">
			<h3 class="fantasy-section-title">
				<span class="title-decoration left"></span>
				<span class="title-text">Diet</span>
				<span class="title-decoration right"></span>
			</h3>
			<div class="grid grid-2col">
				<div class="detail-field">
					<label>{{localize "Appetite"}}</label>
					<input type="number" name="system.diet.appetite.value" value="{{system.diet.appetite.value}}" data-dtype="Number" min="1"/>
				</div>
				<div class="detail-field">
					<label>{{localize "Diet Type"}}</label>
					<input type="text" name="system.diet.type" value="{{system.diet.type}}" placeholder="Carnivore, Herbivore, etc." data-dtype="String"/>
				</div>
			</div>
		</div>

		{{!-- Senses & Talents --}}
		<div class="resource-section" style="margin-top: 20px;">
			{{> "systems/stryder/templates/actor/parts/actor-battle.hbs"}}
		</div>

		{{!-- Abilities & Commands --}}
		<div class="resource-section" style="margin-top: 20px;">
			<h3 class="fantasy-section-title">
				<span class="title-decoration left"></span>
				<span class="title-text">Abilities & Commands</span>
				<span class="title-decoration right"></span>
			</h3>
		</div>

		{{!-- Pet Abilities --}}
		<ol class="items-list" style="margin-top: 8px;">
			<li class="item flexrow items-header">
				<div class="item-name">{{localize "Pet Abilities"}}&nbsp;<i class="toggle-icon fas fa-chevron-down"></i></div>
				<div class="item-controls">
					<a class="item-control item-create" title="Create Ability" data-type="passive">
						<i class="fas fa-plus"></i> {{localize "DOCUMENT.New" type=""}}
					</a>
				</div>
			</li>
			{{#each passive as |item id|}}
			<li class="item flexrow" data-item-id="{{item._id}}">
				<div class="item-name">
					<div class="item-image">
						<a class="rollable" data-roll-type="item">
							<img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
						</a>
					</div>
					<h4>{{item.name}}</h4>
				</div>
				<div class="item-controls">
					<a class="item-control item-duplicate" title="{{localize "STRYDER.DOCUMENT.Duplicate"}}"><i class="fas fa-copy"></i></a>
					<a class="item-control item-edit" title="{{localize "DOCUMENT.Edit" type="passive"}}"><i class="fas fa-edit"></i></a>
					<a class="item-control item-delete" title="{{localize "DOCUMENT.Delete" type="passive"}}"><i class="fas fa-trash"></i></a>
				</div>
			</li>
			{{/each}}
		</ol>

		{{!-- Trust Benefits --}}
		<ol class="items-list">
			<li class="item flexrow items-header">
				<div class="item-name">{{localize "Trust Benefits"}}&nbsp;<i class="toggle-icon fas fa-chevron-down"></i></div>
				<div class="item-controls">
					<a class="item-control item-create" title="Create Trust Benefit" data-type="feature">
						<i class="fas fa-plus"></i> {{localize "DOCUMENT.New" type=""}}
					</a>
				</div>
			</li>
			{{#each features as |item id|}}
			<li class="item flexrow" data-item-id="{{item._id}}">
				<div class="item-name">
					<div class="item-image">
						<a class="rollable" data-roll-type="item">
							<img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
						</a>
					</div>
					<h4>{{item.name}}</h4>
				</div>
				<div class="item-controls">
					<a class="item-control item-duplicate" title="{{localize "STRYDER.DOCUMENT.Duplicate"}}"><i class="fas fa-copy"></i></a>
					<a class="item-control item-edit" title="{{localize "DOCUMENT.Edit" type="feature"}}"><i class="fas fa-edit"></i></a>
					<a class="item-control item-delete" title="{{localize "DOCUMENT.Delete" type="feature"}}"><i class="fas fa-trash"></i></a>
				</div>
			</li>
			{{/each}}
		</ol>

		{{!-- Commands --}}
		<ol class="items-list">
			<li class="item flexrow items-header">
				<div class="item-name">{{localize "Commands"}}&nbsp;<i class="toggle-icon fas fa-chevron-down"></i></div>
				<div class="item-controls">
					<a class="item-control item-create" title="Create Command" data-type="action">
						<i class="fas fa-plus"></i> {{localize "DOCUMENT.New" type=""}}
					</a>
				</div>
			</li>
			{{#each actions as |item id|}}
			<li class="item flexrow" data-item-id="{{item._id}}">
				<div class="item-name">
					<div class="item-image">
						<a class="rollable" data-roll-type="item">
							<img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
						</a>
					</div>
					<h4>{{item.name}}</h4>
				</div>
				<div class="item-controls">
					<a class="item-control item-duplicate" title="{{localize "STRYDER.DOCUMENT.Duplicate"}}"><i class="fas fa-copy"></i></a>
					<a class="item-control item-edit" title="{{localize "DOCUMENT.Edit" type="action"}}"><i class="fas fa-edit"></i></a>
					<a class="item-control item-delete" title="{{localize "DOCUMENT.Delete" type="action"}}"><i class="fas fa-trash"></i></a>
				</div>
			</li>
			{{/each}}
		</ol>

	</div>

	{{!-- Information Tab --}}
	<div class="tab description" data-group="primary" data-tab="description">
		<h2 class="section-header" style="border-bottom: 0px;"><span class="header-decoration left"></span><strong>{{localize "Description"}}</strong><span class="header-decoration right"></span></h2>
		<div class="editor-container biography">
			{{editor system.description target="system.description" rollData=rollData button=true owner=owner editable=editable}}
		</div>
	</div>

</section>
</form>

{{log system}}
