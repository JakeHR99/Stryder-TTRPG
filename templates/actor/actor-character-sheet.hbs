<link href="https://fonts.googleapis.com/css2?family=Tangerine&display=swap" rel="stylesheet">
<link
	href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=MedievalSharp&family=Eagle+Lake:wght@400&display=swap"
	rel="stylesheet">
<form class="{{cssClass}} {{actor.type}} flexcol" autocomplete="off">
	<script>
		function adjustElixirSickness(change) {
			const elixirInput = document.querySelector('input[name="system.elixir_sickness.value"]');
			let currentValue = parseInt(elixirInput.value);

			// Calculate new value within the bounds of 0 to 5
			const newValue = Math.min(5, Math.max(0, currentValue + change));

			// Set the new value back to the input
			elixirInput.value = newValue;

			// Update the actor data
			// Assume actor is globally available or retrieved via some other means
			const actorId = elixirInput.getAttribute('data-actor-id'); // Ensure this attribute is set on the input element if using this method
			const actor = game.actors.get(actorId);
			actor.update({ 'system.elixir_sickness.value': newValue });
		}

		// Enhanced sheen clipping function
		function updateSheenClipping() {
			// Health bar
			const hpBar = document.querySelector('.hp-bar');
			if (hpBar) {
				const hpFillPercent = (hpBar.value / hpBar.max) * 100;
				const hpSheenWrapper = document.querySelector('.hp-sheen-wrapper');
				if (hpSheenWrapper) {
					hpSheenWrapper.style.width = `${hpFillPercent}%`;
				}
			}

			// Mana bar
			const mpBar = document.querySelector('.mp-bar');
			if (mpBar) {
				const mpFillPercent = (mpBar.value / mpBar.max) * 100;
				const mpSheenWrapper = document.querySelector('.mp-sheen-wrapper');
				if (mpSheenWrapper) {
					mpSheenWrapper.style.width = `${mpFillPercent}%`;
				}
			}

			// Stamina bar
			const staminaBar = document.querySelector('.stamina-bar');
			if (staminaBar) {
				const staminaFillPercent = (staminaBar.value / staminaBar.max) * 100;
				const staminaSheenWrapper = document.querySelector('.stamina-sheen-wrapper');
				if (staminaSheenWrapper) {
					staminaSheenWrapper.style.width = `${staminaFillPercent}%`;
				}
			}
		}

		// Wait for DOM to be ready with multiple fallbacks
		function initializeSheenClipping() {
			// Try multiple times to ensure elements are loaded
			let attempts = 0;
			const maxAttempts = 10;

			function tryUpdate() {
				attempts++;
				const hpBar = document.querySelector('.hp-bar');
				const mpBar = document.querySelector('.mp-bar');
				const staminaBar = document.querySelector('.stamina-bar');

				if (hpBar && mpBar && staminaBar) {
					updateSheenClipping();
				} else if (attempts < maxAttempts) {
					setTimeout(tryUpdate, 100);
				}
			}

			tryUpdate();
		}

		// Multiple event listeners for better coverage
		document.addEventListener('DOMContentLoaded', initializeSheenClipping);

		// Foundry VTT specific events
		document.addEventListener('renderActorSheet', function () {
			setTimeout(initializeSheenClipping, 100);
		});

		// Update on any form changes
		document.addEventListener('change', function (e) {
			if (e.target.name && (
				e.target.name.includes('health') ||
				e.target.name.includes('mana') ||
				e.target.name.includes('stamina')
			)) {
				setTimeout(updateSheenClipping, 50);
			}
		});

		// Update on input events for real-time changes
		document.addEventListener('input', function (e) {
			if (e.target.name && (
				e.target.name.includes('health') ||
				e.target.name.includes('mana') ||
				e.target.name.includes('stamina')
			)) {
				setTimeout(updateSheenClipping, 50);
			}
		});

		// Fallback: Update every 2 seconds to catch any missed updates
		setInterval(function () {
			const hpBar = document.querySelector('.hp-bar');
			if (hpBar) {
				updateSheenClipping();
			}
		}, 2000);
	</script>

	<div class="unique-logo-container">
		<img class="logo" src="systems/stryder/assets/stryderfvtt_title.png" width="125" height="125">
	</div>
	{{!-- Sheet Header --}}
	<header class="sheet-header">
		<div class="profile-section" style="margin-top: 35px;">
			<img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
			<div class="ward-container" style="margin-top: 10px; margin-left: -5px;">
				<div class="ward-shield">
					<input type="number" name="system.ward.value" value="{{system.ward.value}}" data-dtype="Number"
						min="0" />
				</div>
				<label class="ward-label">Ward</label>
			</div>
		</div>
		<div class="header-fields">
			<div class="fantasy-input" style="width: 450px; display: flex; align-items: center; gap: 20px;">
				<input name="name" type="text" value="{{actor.name}}" placeholder="Name" style="flex: 1;" />
				<div class="resource flex-group-center" style="margin: 0; padding: 0;">
					<div class="resource-content-level flex-column flex-center">
						<label for="level-value-input" class="resource-label"
							style="margin-top: -10px; margin-bottom: -15px; color: #000000; !important">{{localize
							"Level"}}</label>
						<input type="text" id="level-value-input" name="system.attributes.level.value"
							value="{{system.attributes.level.value}}" data-dtype="Number" />
					</div>
				</div>
			</div><br />
			{{!-- The grid classes are defined in scss/global/_grid.scss. To use,
			use both the "grid" and "grid-Ncol" class where "N" can be any number
			from 1 to 12 and will create that number of columns. --}}
			<div class="character-details-secondary textalign-center flexrow" style="margin-bottom: 8px;">
				<div class="character-gender">
					<label for="{{actor._id}}gender" class="resource-label-info">{{localize "Gender"}}</label>
					<input id="{{actor._id}}gender" type="text" name="system.attributes.gender"
						value="{{system.attributes.gender}}" placeholder="Gender" data-dtype="String" />
				</div>
				<div class="character-pronouns">
					<label for="{{actor._id}}pronouns" class="resource-label-info">{{localize "Pronouns"}}</label>
					<input id="{{actor._id}}pronouns" type="text" name="system.attributes.pronouns"
						value="{{system.attributes.pronouns}}" placeholder="He/She/They, etc." data-dtype="String" />
				</div>
				<div class="character-weightclass">
					<label for="{{actor._id}}creature_size" class="resource-label-info">{{localize "Creature
						Size"}}</label>
					<div class="dropdown-field">
						<select class="secondary-input" name="system.attributes.creature_size"
							style="width: 100%; font-size: 16px; font-weight: normal;">
							{{#select system.attributes.creature_size}}
							<option value="0.25">{{localize "Mini"}}</option>
							<option value="0.5">{{localize "Small"}}</option>
							<option value="1">{{localize "Normal"}}</option>
							<option value="2">{{localize "Huge"}}</option>
							<option value="3">{{localize "Massive"}}</option>
							<option value="4">{{localize "Colossal"}}</option>
							<option value="5">{{localize "Titanic"}}</option>
							{{/select}}
						</select>
					</div>
				</div>
			</div>
			<div class="resources grid grid-3col">

				{{!-- "flex-group-center" is also defined in the _grid.scss file
				and it will add a small amount of padding, a border, and will
				center all of its child elements content and text. --}}

				<div class="resource flex-group-center">
					<label for="system.health.value" class="resource-label"><img
							style="width: 15px; height: 15px; border: 0px; position: relative; top: 15px; left: -5px; margin-left: 15px;"
							src="systems/stryder/assets/health-symbol.svg">{{localize "Health"}}</label>
					<div class="hpbar">
						<div class="hp-progress-bar">
							<progress class="hp-bar grid-span-3" value="{{system.health.value}}"
								max="{{system.health.max}}"></progress>
							<div class="hp-sheen-wrapper">
								<div class="hp-sheen"></div>
							</div>
						</div>
					</div>
					<div class="resource-content flexrow flex-center flex-between">
						<input type="text" name="system.health.value" value="{{system.health.value}}"
							data-dtype="Number" placeholder="Current" />
						<span> / </span>
						<input type="text" name="system.health.max" value="{{system.health.max}}"
							data-dtype="Number" placeholder="Max" />
					</div>
				</div>

				<div class="resource flex-group-center">
					<label for="system.mana.value" class="resource-label"><img
							style="width: 20px; height: 20px; border: 0px; position: relative; top: 10px; margin-bottom: -5px; left: -5px; margin-left: 15px;"
							src="systems/stryder/assets/mana-symbol.svg">{{localize "Mana"}}</label>
					<div class="mpbar">
						<div class="mp-progress-bar">
							<progress class="mp-bar grid-span-3" value="{{system.mana.value}}"
								max="{{system.mana.max}}"></progress>
							<div class="mp-sheen-wrapper">
								<div class="mp-sheen"></div>
							</div>
						</div>
					</div>
					<div class="resource-content flexrow flex-center flex-between">
						<input type="text" name="system.mana.value" value="{{system.mana.value}}" data-dtype="Number"
							placeholder="Current" />
						<span> / </span>
						<input type="text" name="system.mana.max" value="{{system.mana.max}}"
							data-dtype="Number" placeholder="Max" />
					</div>
				</div>

				<div class="resource flex-group-center">
					<label for="system.stamina.value" class="resource-label"><img
							style="width: 20px; height: 20px; border: 0px; position: relative; top: 10px; margin-bottom: -6px; left: 0px; margin-left: 15px;"
							src="systems/stryder/assets/stamina-symbol.svg">{{localize "Stamina"}} </label>
					<div class="staminabar">
						<div class="stamina-progress-bar">
							<progress class="stamina-bar grid-span-3" value="{{system.stamina.value}}"
								max="{{system.stamina.max}}"></progress>
							<div class="stamina-sheen-wrapper">
								<div class="stamina-sheen"></div>
							</div>
						</div>
					</div>
					<div class="resource-content flexrow flex-center flex-between">
						<input type="text" name="system.stamina.value" value="{{system.stamina.value}}"
							data-dtype="Number" placeholder="Current" />
						<span> / </span>
						<input type="text" name="system.stamina.max" value="{{system.stamina.max}}"
							data-dtype="Number" placeholder="Max" />
					</div>
				</div>

			</div>

		</div>
	</header>

	{{!-- Sheet Tab Navigation --}}
	<nav class="sheet-tabs tabs" data-group="primary">
		{{!-- Default tab is specified in actor-sheet.mjs --}}
		<a class="item" data-tab="features">{{localize "Battle"}}</a>
		<a class="item" data-tab="battle">{{localize "Exploration"}}</a>
		<a class="item" data-tab="life">{{localize "Life"}}</a>
		<a class="item" data-tab="items">{{localize "Inventory"}}</a>
		<a class="item" data-tab="description">{{localize "Biography"}}</a>
		<a class="item" data-tab="effects">{{localize "Effects"}}</a>
	</nav>

	{{!-- Sheet Body --}}
	<section class="sheet-body">

		{{!-- Owned Features Tab --}}
		<div class="tab features" data-group="primary" data-tab="features">
			<section class="grid grid-3col">
				<aside class="sidebar">

					{{!-- Turn Start / Limit Reset / Resting / Spring of Life Buttons --}}
					<div class="resource-buttons fantasy-action-buttons sidebar-action-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px;">
						<div class="fantasy-button-container">
							<button class="resource-button fantasy-action-button" data-action="turnStart" title="{{localize 'Turn Start Description'}}">
								<div class="button-icon-container">
									<img src="systems/stryder/assets/turn-start.svg" class="button-icon"/>
									<div class="button-icon-glow"></div>
								</div>
								<span class="button-text"><strong>{{localize "Turn Start"}}</strong></span>
								<div class="button-shine"></div>
							</button>
						</div>
						<div class="fantasy-button-container">
							<button class="resource-button fantasy-action-button" data-action="limitReset" title="Reset all Limit counters to 0">
								<div class="button-icon-container">
									<img src="systems/stryder/assets/turn-start.svg" class="button-icon"/>
									<div class="button-icon-glow"></div>
								</div>
								<span class="button-text"><strong>Limit Reset</strong></span>
								<div class="button-shine"></div>
							</button>
						</div>
						<div class="fantasy-button-container">
							<button class="resource-button fantasy-action-button" data-action="resting" title="{{localize 'Resting Description'}}">
								<div class="button-icon-container">
									<img src="systems/stryder/assets/resting.svg" class="button-icon"/>
									<div class="button-icon-glow"></div>
								</div>
								<span class="button-text"><strong>{{localize "Resting"}}</strong></span>
								<div class="button-shine"></div>
							</button>
						</div>
						<div class="fantasy-button-container">
							<button class="resource-button fantasy-action-button" data-action="springOfLife" title="{{localize 'Spring of Life Description'}}">
								<div class="button-icon-container">
									<img src="systems/stryder/assets/spring-of-life.svg" class="button-icon"/>
									<div class="button-icon-glow"></div>
								</div>
								<span class="button-text"><strong>{{localize "Spring of Life"}}</strong></span>
								<div class="button-shine"></div>
							</button>
						</div>
					</div>

					<div class="fantasy-elixir-sickness">
						<div class="elixir-sickness-header">
							<h3 class="fantasy-section-title">
								<span class="title-decoration left"></span>
								<span class="title-text">{{localize "Elixir Sickness"}}</span>
								<span class="title-decoration right"></span>
							</h3>
						</div>
						<div class="resource flex-group-center">
							<div class="elixir-sickness-bar">
								<button type="button" class="life-skill-btn minus" onclick="adjustElixirSickness(-1)">-</button>
								<input type="text" name="system.elixir_sickness.value"
									value="{{system.elixir_sickness.value}}" data-actor-id="{{actor.id}}" readonly
									class="elixir-sickness-input" />
								<button type="button" class="life-skill-btn plus" onclick="adjustElixirSickness(1)">+</button>
							</div>
						</div>
					</div>

					{{!-- Stat Perks Section --}}
					<div class="flexcol-stats scroll-wrapper">
						<h3 class="fantasy-section-title">
							<span class="title-decoration left"></span>
							<span class="title-text">Stat Perks</span>
							<span class="title-decoration right"></span>
						</h3>
						<ol class='items-list'>
							<li class='item flexrow items-header'>
								<div class='item-name'>{{localize 'Stat Perks'}}&nbsp<i class='toggle-icon fas fa-chevron-down'></i></div>
								<div class='item-controls'>
									<a class='item-control item-create' title='Create item' data-type='statperk'>
										<i class='fas fa-plus'></i>
									</a>
								</div>
							</li>
							<div class="scrolling-content">
								{{#each statperks as |item id|}}
									<li class='item flexrow' data-item-id='{{item._id}}'>
										<div class='item-name rollable' data-roll-type='item'>
											<div class='item-image'>
												<a class='rollable' data-roll-type='item'>
													<img src='{{item.img}}' title='{{item.name}}' width='24' height='24'/>
												</a>
											</div>
											<h4>{{item.name}}</h4>
										</div>
										<div class='item-controls'>
											<a class='item-control item-duplicate' title='{{localize "STRYDER.DOCUMENT.Duplicate"}}' data-action='duplicate'>
												<i class='fas fa-copy'></i>
											</a>
											<a class='item-control item-edit' title='{{localize "DOCUMENT.Edit" type='statperk'}}' data-action='edit'>
												<i class='fas fa-edit'></i>
											</a>
											<a class='item-control item-delete' title='{{localize "DOCUMENT.Delete" type='statperk'}}' data-action='delete'>
												<i class='fas fa-trash'></i>
											</a>
										</div>
									</li>
								{{/each}}
							</div>
						</ol>
					</div>
					<br />

					{{!-- Quick Actions Section --}}
					<div class="fantasy-combat-abilities">
						<div class="combat-abilities-header">
							<h3 class="fantasy-section-title">
								<span class="title-decoration left"></span>
								<span class="title-text">Quick Actions</span>
								<span class="title-decoration right"></span>
							</h3>
						</div>

						<!-- Dodge & Evade Row -->
						<div class="combat-row">
							<div class="fantasy-combat-button-container">
								<span class="fantasy-combat-button ability-dodge-evade-mod rollable"
									data-custom-roll="1d6+@abilities.Reflex.value+@reflex_tag.bonus" data-label="Dodge Roll">
									<div class="combat-icon-container">
										<img src="systems/stryder/assets/dodge.svg" class="combat-icon" />
										<div class="combat-icon-glow"></div>
									</div>
									<span class="combat-button-text"><strong>{{localize "Dodge"}}</strong></span>
									<div class="combat-button-shine"></div>
								</span>
							</div>
							<div class="fantasy-combat-button-container">
								<span class="fantasy-combat-button ability-dodge-evade-mod rollable"
									data-custom-roll="2d6+@abilities.Reflex.value+@reflex_tag.bonus" data-label="Evade Roll">
									<div class="combat-icon-container">
										<img src="systems/stryder/assets/evade.svg" class="combat-icon" />
										<div class="combat-icon-glow"></div>
									</div>
									<span class="combat-button-text"><strong>{{localize "Evade"}}</strong></span>
									<div class="combat-button-shine"></div>
								</span>
							</div>
						</div>

						<!-- Reflex Tag Bonus -->
						<div class="reflex-tag-bonus-row">
							<label class="reflex-tag-label">Reflex Tag Bonus</label>
							<input type="number" name="system.reflex_tag.bonus" value="{{system.reflex_tag.bonus}}" data-dtype="Number" class="reflex-tag-input" />
						</div>

						<!-- Vertical & Horizontal Row -->
						<div class="combat-row">
							<div class="fantasy-combat-button-container">
								<span class="fantasy-combat-button ability-dodge-evade-mod rollable" data-jump-type="vertical">
									<div class="combat-icon-container">
										<img src="systems/stryder/assets/vertical-jump-icon.svg" class="combat-icon" />
										<div class="combat-icon-glow"></div>
									</div>
									<span class="combat-button-text"><strong>{{localize "Vertical"}}</strong></span>
									<div class="combat-button-shine"></div>
								</span>
							</div>
							<div class="fantasy-combat-button-container">
								<span class="fantasy-combat-button ability-dodge-evade-mod rollable" data-jump-type="horizontal">
									<div class="combat-icon-container">
										<img src="systems/stryder/assets/horizontal-jump-icon.svg" class="combat-icon" />
										<div class="combat-icon-glow"></div>
									</div>
									<span class="combat-button-text"><strong>{{localize "Horizontal"}}</strong></span>
									<div class="combat-button-shine"></div>
								</span>
							</div>
						</div>

						<!-- Leap Bonus -->
						<div class="reflex-tag-bonus-row">
							<label class="reflex-tag-label">Leap Bonus</label>
							<input type="number" name="system.leap_bonus.bonus" value="{{system.leap_bonus.bonus}}" data-dtype="Number" class="reflex-tag-input" />
						</div>

						<!-- Grapple Row -->
						<div class="combat-row">
							<div class="fantasy-combat-button-container">
								<span class="fantasy-combat-button ability-dodge-evade-mod rollable" data-action-type="grapple">
									<div class="combat-icon-container">
										<img src="systems/stryder/assets/grapple-icon.svg" class="combat-icon" />
										<div class="combat-icon-glow"></div>
									</div>
									<span class="combat-button-text"><strong>{{localize "Grapple"}}</strong></span>
									<div class="combat-button-shine"></div>
								</span>
							</div>
						</div>
					</div>

				</aside>
				{{!-- For the main features list, span the right two columns --}}
				<section class="main grid-span-2">
					{{!-- This is a Handlebars partial. They're stored in the `/parts` folder next to this sheet, and
					defined in module/helpers/templates.mjs --}}
					{{> "systems/stryder/templates/actor/parts/actor-features.hbs"}}
				</section>

			</section>
		</div>

		<!-- Battle Tab -->

		<!--Expertise Calculation -->
		<!-- DISABLED: Manual movement speed control - these calculations were overwriting player edits
		<script>
			Hooks.once("renderActorSheet", function (actorSheet, html, data) {
				const actor = actorSheet.actor;

				// Handle running expertise calculation
				updateRunningSpeedBasedOnExpertise(actor);

				// Handle climbing speed calculation
				updateClimbingSpeedBasedOnExpertise(actor);

				// Handle climbing speed calculation
				updateCrawlingSpeedBasedOnExpertise(actor);

				// Handle climbing speed calculation
				updateMarchingSpeedBasedOnExpertise(actor);

				// Handle climbing speed calculation
				updateSwimmingSpeedBasedOnExpertise(actor);
			});

			function updateRunningSpeedBasedOnExpertise(actor) {
				const running = actor.system.attributes.move.running;
				if (running.expertise) {
					const newRunningValue = 11;
					actor.update({
						"system.attributes.move.running.value": newRunningValue
					});
				} else {
					actor.update({
						"system.attributes.move.running.value": 7
					});
				}
			}

			function updateClimbingSpeedBasedOnExpertise(actor) {
				const climbing = actor.system.attributes.move.climbing;
				if (climbing.expertise) {
					const newClimbingValue = 6 + actor.system.attributes.talent.strength.value;
					actor.update({
						"system.attributes.move.climbing.value": newClimbingValue
					});
				} else {
					actor.update({
						"system.attributes.move.climbing.value": 3
					});
				}
			}

			function updateCrawlingSpeedBasedOnExpertise(actor) {
				const crawling = actor.system.attributes.move.crawling;
				if (crawling.expertise) {
					const newCrawlingValue = 4 + actor.system.attributes.talent.nimbleness.value;
					actor.update({
						"system.attributes.move.crawling.value": newCrawlingValue
					});
				} else {
					actor.update({
						"system.attributes.move.crawling.value": 2
					});
				}
			}

			function updateMarchingSpeedBasedOnExpertise(actor) {
				const marching = actor.system.attributes.move.marching;
				if (marching.expertise) {
					const newMarchingValue = 7;
					actor.update({
						"system.attributes.move.marching.value": newMarchingValue
					});
				} else {
					actor.update({
						"system.attributes.move.marching.value": 4
					});
				}
			}

			function updateSwimmingSpeedBasedOnExpertise(actor) {
				const swimming = actor.system.attributes.move.swimming;
				if (swimming.expertise) {
					const newSwimmingValue = 6 + actor.system.attributes.talent.nimbleness.value;
					actor.update({
						"system.attributes.move.swimming.value": newSwimmingValue
					});
				} else {
					actor.update({
						"system.attributes.move.swimming.value": 4
					});
				}
			}
		</script>
		-->

		<div class="tab battle" data-group="primary" data-tab="battle">
			<h2 class="section-header" style="border-bottom: 0px;">
				<span class="header-decoration left"></span>
				<img src="systems/stryder/assets/movement-speeds.svg" width="25px" height="25px"
					style="border:0px; position: relative; top: 0px; left: -10px;">
				<strong>{{localize "Movement Speeds"}}</strong>
				<span class="header-decoration right"></span>
			</h2>

			<div class="movement-container">
				<!-- Base Movement Speed -->
				<div class="base-movement-section">
					<div class="flexrow flex-group-center-speed">
						<img src="systems/stryder/assets/run.svg" width="30px" height="30px"
							style="border:0px; margin-right: -20px; margin-left: -10px;">
						<label><b>{{localize "Current Movement"}}</b></label>
					</div>
					<div class="speed-input-container">
						<span class="speed-input-box">
							<input type="text" name="system.attributes.move.running.value"
								value="{{system.attributes.move.running.value}}" data-dtype="Number">
						</span>
					</div>

					<!-- Movement Rules Text -->
					<div class="movement-rules">
						<div class="rules-scroll">
							<p class="rules-text">
								<span class="rules-highlight">{{localize "Movement Basics"}}:</span> {{localize
								"Movement Basics Description"}}
							</p>
							<p class="rules-text">
								<span class="rules-highlight">{{localize "Engagement & Recovery"}}:</span> {{localize
								"Engagement Recovery Description"}}
							</p>
							<p class="rules-text">
								<span class="rules-highlight">{{localize "Baseline & Modifiers"}}:</span> {{localize
								"Baseline Modifiers Description"}}
							</p>
						</div>
					</div>
				</div>

				<!-- Movement Expertises -->
				<div class="expertise-section">
					<h3 class="expertise-title">{{localize "Movement Expertises"}}</h3>
					<div class="expertise-grid">
						<div class="expertise-item" data-tooltip="<b>Running Expertise:</b> Raises your Movement by 4.">
							<span class="expertise-label">{{localize "Running"}}</span>
							<input type="checkbox" name="system.attributes.move.running.expertise" {{checked system.attributes.move.running.expertise}} style="width: 20px; height: 20px;">
						</div>

						<div class="expertise-item"
							data-tooltip="<b>Climbing Expertise:</b> Grants the passive ability Cling. Cling allows you to dangle off of a surface you are climbing with one free hand, allowing you to perform one handed actions while occupying Climbing Terrain spaces. You can traverse Climbing spaces at a rate of 2 Movement per space.">
							<span class="expertise-label">{{localize "Climbing"}}</span>
							<input type="checkbox" name="system.attributes.move.climbing.expertise" {{checked system.attributes.move.climbing.expertise}} style="width: 20px; height: 20px;">
						</div>

						<div class="expertise-item"
							data-tooltip="<b>Marching Expertise:</b> You can traverse Marching spaces at a rate of 1 Movement per space.">
							<span class="expertise-label">{{localize "Marching"}}</span>
							<input type="checkbox" name="system.attributes.move.marching.expertise" {{checked system.attributes.move.marching.expertise}} style="width: 20px; height: 20px;">
						</div>

						<div class="expertise-item"
							data-tooltip="<b>Swimming Expertise:</b> Grants the passive Combat Floating. Floating removes the -4 penalty from players when they occupy a Swimming Terrain space. You can traverse Swimming spaces at a rate of 2 Movement per space.">
							<span class="expertise-label">{{localize "Swimming"}}</span>
							<input type="checkbox" name="system.attributes.move.swimming.expertise" {{checked system.attributes.move.swimming.expertise}} style="width: 20px; height: 20px;">
						</div>
					</div>
				</div>
			</div>

			<br />

			{{> "systems/stryder/templates/actor/parts/actor-battle.hbs"}}
		</div>

		{{!-- Running Expertise Toggle Script --}}
		<script>
			Hooks.on("renderActorSheet", function (actorSheet, html, data) {
				// Check if we've already attached the listener to this sheet
				if (html.data('running-expertise-listener-attached')) {
					return; // Already attached, skip
				}

				// Mark this sheet as having the listener attached
				html.data('running-expertise-listener-attached', true);

				// Use event delegation on the html element (won't create duplicates)
				html.on('change', 'input[name="system.attributes.move.running.expertise"]', function() {
					const actor = actorSheet.actor;
					const isChecked = this.checked;
					const currentMovement = actor.system.attributes.move.running.value;

					// Add 4 if checked, subtract 4 if unchecked
					const newMovement = isChecked ? currentMovement + 4 : currentMovement - 4;

					// Update the movement value
					actor.update({
						"system.attributes.move.running.value": newMovement
					});
				});
			});
		</script>

		{{!-- Life Tab --}}
		<div class="tab items" data-group="primary" data-tab="life">
			{{> "systems/stryder/templates/actor/parts/actor-life.hbs"}}
		</div>

		{{!-- Biography Tab --}}
		<div class="tab biography" data-group="primary" data-tab="description">
			<div class="biography-header">
				<h1 class="parchment-title">{{localize "Character Chronicle"}}</h1>
			</div>

			{{!-- Character Details Section --}}
			<div class="character-details-container">
				<div class="scroll-border top"></div>

				<div class="character-details-secondary textalign-center flexrow">
					<div class="birthplace detail-field">
						<label for="{{actor._id}}birthplace" class="resource-label fancy-label">{{localize
							"Birthplace"}}</label>
						<div class="input-frame">
							<input id="{{actor._id}}birthplace" type="text" name="system.details.birthplace"
								value="{{system.details.birthplace}}" data-dtype="String" />
						</div>
					</div>
					<div class="nationality detail-field">
						<label for="{{actor._id}}nationality" class="resource-label fancy-label">{{localize
							"Nationality"}}</label>
						<div class="input-frame">
							<input id="{{actor._id}}nationality" type="text" name="system.details.nationality"
								value="{{system.details.nationality}}" data-dtype="String" />
						</div>
					</div>
				</div>

				<div class="character-details-secondary textalign-center flexrow">
					<div class="age detail-field">
						<label for="{{actor._id}}age" class="resource-label fancy-label">{{localize "Age"}}</label>
						<div class="input-frame">
							<input id="{{actor._id}}age" type="number" name="system.details.age"
								value="{{system.details.age}}" data-dtype="Number" />
						</div>
					</div>
					<div class="height detail-field">
						<label for="{{actor._id}}height" class="resource-label fancy-label">{{localize
							"Height"}}</label>
						<div class="input-frame">
							<input id="{{actor._id}}height" type="text" name="system.details.height"
								value="{{system.details.height}}" data-dtype="String" />
						</div>
					</div>
					<div class="weightclass detail-field">
						<label for="{{actor._id}}weight_class" class="resource-label fancy-label">{{localize "Weight
							Class"}}</label>
						<div class="input-frame">
							<input id="{{actor._id}}weight_class" type="text" name="system.attributes.weight_class"
								value="{{system.attributes.weight_class}}" placeholder="4" data-dtype="Number" />
						</div>
					</div>
				</div>

				<div class="scroll-border bottom"></div>
			</div>

			{{!-- Appearance Section --}}
			<div class="appearance-container">
				<h2 class="section-header" style="border-bottom: 0px;"><span class="header-decoration left"></span><img
						src="systems/stryder/assets/visage.svg" width="25px" height="25px"
						style="border:0px; position: relative; top: 0px; left: -10px;"><strong>{{localize
						"Visage"}}</strong><span class="header-decoration right"></span></h2>
			</div>
			<div class="editor-container biography">
				{{editor system.appearance target="system.appearance" rollData=rollData button=true owner=owner
				editable=editable}}
			</div>

			{{!-- Backstory Section --}}
			<div class="backstory-container">
				<h2 class="section-header" style="border-bottom: 0px;"><span class="header-decoration left"></span><img
						src="systems/stryder/assets/legend.svg" width="25px" height="25px"
						style="border:0px; position: relative; top: 0px; left: -10px;"><strong>{{localize
						"Legend"}}</strong><span class="header-decoration right"></span></h2>
			</div>
			<div class="editor-container biography">
				{{editor system.biography target="system.biography" rollData=rollData button=true owner=owner
				editable=editable}}
			</div>

			{{!-- Personality Section --}}
			<div class="personality-container">
				<h2 class="section-header" style="border-bottom: 0px;"><span class="header-decoration left"></span><img
						src="systems/stryder/assets/personality.svg" width="25px" height="25px"
						style="border:0px; position: relative; top: 0px; left: -10px;"><strong>{{localize
						"Personality"}}</strong><span class="header-decoration right"></span></h2>
			</div>
			<div class="editor-container biography">
				{{editor system.personality target="system.personality" rollData=rollData button=true owner=owner
				editable=editable}}
			</div>
		</div>

		{{!-- Owned Items Tab --}}
		<div class="tab items" data-group="primary" data-tab="items">
			{{> "systems/stryder/templates/actor/parts/actor-items.hbs"}}
		</div>

		{{!-- Active Effects Tab --}}
		<div class="tab effects flexcol" data-group="primary" data-tab="effects">
			{{> "systems/stryder/templates/actor/parts/actor-effects.hbs"}}
		</div>

	</section>
</form>

{{log system}}